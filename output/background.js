function e(e){chrome.storage.local.get(["siteList"],(async t=>{if(null==t?void 0:t.siteList){let s=[...t.siteList,...e].reverse();s=s.reduce(((e,t)=>(e.some((e=>e.site===t.site&&(null==e?void 0:e.port)===(null==t?void 0:t.port)))||e.push({...t,id:Date.now()+1e4*Math.random()}),e)),[]),await chrome.storage.local.set({siteList:s})}else await chrome.storage.local.set({siteList:e.map((e=>({...e,id:Date.now()+1e4*Math.random()})))});return!0}))}chrome.runtime.onInstalled.addListener((function(t){"install"===t.reason&&(console.log("====","Installed"),e([]))})),chrome.runtime.onUpdateAvailable.addListener((function(e){console.log("插件有新的版本了")})),chrome.runtime.onMessage.addListener((function({event:t,data:s},o,i){switch(t){case"initAction":r=i,e([]),r();break;case"getSiteList":return chrome.storage.local.get(["siteList"],(async e=>(i(e),!0))),!0;case"setSiteList":return chrome.storage.local.get(["siteList"],(async e=>{let t=e.siteList;return t?t.some((e=>(null==e?void 0:e.id)===s.id))?t.forEach(((e,o)=>{e.id===s.id&&t.splice(o,1,s)})):t.push(s):t=[s],chrome.storage.local.set({siteList:t},(async()=>(i("success"),!0))),!0})),!0;case"delSiteList":return chrome.storage.local.get(["siteList"],(async e=>{let t=e.siteList;return s.id?(t=t.filter((e=>e.id!==s.id)),chrome.storage.local.set({siteList:t},(async()=>(i("success"),!0))),!0):(i("fail"),!0)})),!0;case"setFlagHostListPosition":return chrome.storage.local.set(s,(async()=>(i("存储成功"),!0))),!0;case"getFlagHostListPosition":return chrome.storage.local.get(["flagHostListPosition"],(e=>(i(e),!0))),!0;case"importSiteList":return e(s),i(!0),!0;case"getGoodsList":return chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"toGetGoodsList"})})),i(!0),!0;case"getAllGoodsList":return chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"toGetAllGoodsList"})})),i(!0),!0}var r;return!0}));try{chrome.contextMenus.create({type:"normal",title:"批量打开编辑",id:"performAction",contexts:["all"]},(e=>{console.log("彩蛋🥚🥚🥚 callback")})),chrome.contextMenus.onClicked.addListener((function(e,t){"performAction"===e.menuItemId&&chrome.tabs.sendMessage(t.id,{action:"performAction"})}))}catch(t){console.error(t)}
